# PlantUML図表作成サービス 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
PlantUML図表作成サービス

### 1.2 プロジェクトの目的
- ソフトウェアエンジニアがPlantUMLを使用して各種UML図を簡単に作成できるWebサービスの提供
- テキストベースの記述から図表への変換により、効率的なソフトウェア設計・モデリングの実現
- 実際の現場でのAI駆動開発に活かせる開発フローの確立

### 1.3 プロジェクトのゴール
- チーム全体で日常的に利用できるUML図作成環境の構築
- 要件定義 → 設計 → 実装(TDD) → 統合受け入れテストの開発フロー実践
- AWS上での本番環境運用

### 1.4 対象ユーザー
- **主要ターゲット**: 開発チーム全体
- **利用頻度**: 日常的な利用を想定
- **同時接続数**: 10〜100人程度

## 2. 機能要件

### 2.1 ユーザー種別と権限

#### 2.1.1 ゲストユーザー
**利用可能機能:**
- PlantUMLエディタの使用
- リアルタイムプレビュー（キーストロークごと）
- 手動更新ボタンによる図表再生成
- 図表のダウンロード（PNG/SVG/TXT形式）
- チートシート閲覧
- プラクティス問題への挑戦
- LocalStorageによる一時保存（24時間）

**制限事項:**
- 作成した図表の永続的な保存不可
- プロジェクト管理機能の利用不可
- 履歴管理機能の利用不可
- 学習進捗の保存不可
- レート制限: 1分間に3回まで図表生成可能

#### 2.1.2 ログインユーザー
**追加利用可能機能:**
- プロジェクト管理（最大3プロジェクト）
- 図表の永続的な保存
- 履歴管理
- 学習進捗の保存
- 30秒ごとの自動保存
- レート制限: 1分間に10回まで図表生成可能

**認証方式:**
- Laravel12標準認証（メール/パスワード）
- Laravel Breeze + React使用

### 2.2 エディタ機能

#### 2.2.1 基本機能
- **エディタ**: Monaco Editor使用
- **対応図表タイプ**:
  - ユースケース図
  - クラス図
  - アクティビティ図
  - 状態図
  - コンポーネント図
  - シーケンス図
  - ER図
  - マインドマップ
  - ガントチャート

#### 2.2.2 エディタ補助機能
- シンタックスハイライト
- オートコンプリート
- エラー表示
- テンプレート機能
- チートシート（構文リファレンス）

#### 2.2.3 プレビュー機能
- リアルタイムプレビュー（キーストロークごと）
- 手動更新ボタン
- 出力形式: SVG、PNG、ASCII（TXT）

### 2.3 プロジェクト管理機能

#### 2.3.1 プロジェクト構造
- 1ユーザーあたり最大3プロジェクト
- 1プロジェクトあたり最大10図表
- フォルダ階層: 最大2階層
- 1フォルダあたり最大10図表
- フォルダ名: 最大100文字

#### 2.3.2 プロジェクト設定
- プロジェクト名
- プロジェクト説明
- デフォルトテンプレート選択
  - システム設計用（クラス図、シーケンス図）
  - データベース設計用（ER図）
  - その他カスタムテンプレート

### 2.4 プラクティス機能

#### 2.4.1 問題構成
- 難易度別問題セット
  - 初級: 10問
  - 中級: 10問
  - 上級: 10問
- カテゴリ別分類（図表タイプごと）

#### 2.4.2 学習管理
- 進捗状況の記録（ログインユーザーのみ）
- 正解例の表示
- 問題は事前に用意（静的コンテンツ）

### 2.5 ダッシュボード機能

#### 2.5.1 表示情報
- 作成した図表一覧（サムネイル付き）
- 最近の活動履歴
- プロジェクトごとの統計
  - 図表数
  - 最終更新日
- プラクティス問題の進捗状況

## 3. 非機能要件

### 3.1 パフォーマンス要件
- **図表生成時間**: 1秒以内
- **同時接続数**: 100人まで対応
- **レスポンスタイム**: 
  - API応答: 200ms以内（図表生成を除く）
  - ページロード: 3秒以内

### 3.2 可用性要件
- **稼働率**: 99.5%以上
- **計画停止**: 月1回、深夜帯のメンテナンス許容

### 3.3 セキュリティ要件
- HTTPS通信の強制
- CSRF対策
- XSS対策
- SQLインジェクション対策
- 適切な認証・認可の実装

### 3.4 制限事項
- **PlantUMLコード**: 最大10,000文字
- **生成画像サイズ**: 最大5MB
- **レート制限**:
  - ゲストユーザー: 1分間に3回
  - ログインユーザー: 1分間に10回

## 4. システム構成

### 4.1 インフラ構成
#### AWS構成
- **EC2**: 2台構成（冗長化）
- **データベース**: Amazon Aurora（MySQL互換）
  - 本番: Aurora
  - ローカル開発: MySQL（port 3306）
- **ロードバランサー**: Application Load Balancer
- **ストレージ**: S3
- **ネットワーク**: Private Subnet構成
- **監視**: CloudWatch

#### PlantUMLサーバー
- Dockerコンテナとして別途起動
- EC2インスタンス上で実行

### 4.2 技術スタック
#### フロントエンド
- React 19
- Inertia.js
- Monaco Editor
- Tailwind CSS

#### バックエンド
- PHP 8.4
- Laravel 12
- Nginx 1.27
- PHP-FPM 8.4

#### 開発環境
- DevContainer
- Docker Compose
- ローカルMySQL（Homebrew経由）

### 4.3 CI/CD
- GitHub Actions
- 自動テスト実行
- AWS自動デプロイ

## 5. データ設計概要

### 5.1 主要エンティティ
1. **Users**
   - id, email, password, created_at, updated_at

2. **Projects**
   - id, user_id, name, description, template_type, created_at, updated_at

3. **Folders**
   - id, project_id, parent_folder_id, name, created_at, updated_at

4. **Diagrams**
   - id, project_id, folder_id, name, plantuml_code, svg_path, png_path, created_at, updated_at

5. **DiagramHistories**
   - id, diagram_id, plantuml_code, version, created_at

6. **PracticeProgress**
   - id, user_id, problem_id, status, completed_at, created_at, updated_at

### 5.2 ストレージ設計
#### S3バケット構造
```
plantuml-service/
├── generated/
│   ├── guest/
│   │   └── {session_id}/
│   │       ├── {timestamp}.png
│   │       └── {timestamp}.svg
│   └── users/
│       └── {user_id}/
│           └── {diagram_id}/
│               ├── current.png
│               ├── current.svg
│               └── history/
│                   └── {version}.png
└── templates/
    └── {template_type}/
        └── {template_name}.puml
```

### 5.3 バックアップ戦略
#### データベース（Aurora）
- 自動バックアップ: 毎日
- 保持期間: 7日間
- ポイントインタイムリカバリ: 有効

#### S3ライフサイクルポリシー
- ゲスト生成ファイル: 1時間後に自動削除
- ログインユーザーファイル: 
  - 30日後: Glacierへ移行
  - 90日後: 完全削除
- バージョニング: 無効（コスト削減）

## 6. 開発フェーズ

### Phase 1: MVP（2週間）
- [ ] 基本的なエディタ機能実装
- [ ] PlantUML → 図表変換機能
- [ ] ゲストユーザー機能
- [ ] ダウンロード機能（PNG/SVG/TXT）
- [ ] LocalStorageによる一時保存

### Phase 2: ユーザー機能（2週間）
- [ ] ユーザー認証（既存のLaravel Breeze活用）
- [ ] ダッシュボード拡張
- [ ] プロジェクト管理機能
- [ ] 図表の永続保存
- [ ] 履歴管理機能
- [ ] 自動保存機能

### Phase 3: 学習機能（1週間）
- [ ] プラクティス問題機能
- [ ] 進捗管理機能
- [ ] テンプレート機能の拡充

### Phase 4: 本番環境構築（1週間）
- [ ] AWS環境構築
- [ ] CI/CDパイプライン構築
- [ ] 監視設定
- [ ] 負荷テスト
- [ ] セキュリティテスト

## 7. 制約事項とスコープ外項目

### 7.1 スコープ外
- モバイルアプリ版の開発
- 他の図表作成ツール（Draw.io、Mermaid等）との連携
- チーム協働編集機能（リアルタイムコラボレーション）
- 有料プラン・課金機能
- 外部API提供
- 多言語対応（日本語以外）
- PlantUMLの拡張構文サポート
- 図表からのコード生成機能
- 共有機能（URLによる図表共有）

### 7.2 技術的制約
- PlantUMLの標準構文のみサポート
- 同時編集は非対応（last-write-wins方式）
- ブラウザ要件: Chrome, Firefox, Safari, Edge の最新2バージョン

## 8. 監視・運用要件

### 8.1 監視項目（CloudWatch）
- **アプリケーションメトリクス**
  - 図表生成回数
  - エラー率
  - API応答時間
  - 人気の図表タイプ

- **インフラメトリクス**
  - CPU使用率
  - メモリ使用率
  - ディスク使用率
  - ネットワークI/O

### 8.2 アラート設定
- エラー率が5%を超えた場合
- レスポンスタイムが3秒を超えた場合
- CPU使用率が80%を超えた場合
- ディスク使用率が90%を超えた場合

## 9. テスト要件

### 9.1 テスト種別
- **単体テスト**: PHPUnit使用、カバレッジ80%以上
- **統合テスト**: Feature Test実装
- **E2Eテスト**: Playwright使用
- **パフォーマンステスト**: JMeter使用

### 9.2 受け入れ基準
- 全テストケースの成功
- パフォーマンス要件の達成
- セキュリティ脆弱性診断のパス
- 100同時接続での安定動作

## 10. リスクと対策

### 10.1 技術的リスク
| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| PlantUMLサーバーの負荷集中 | 高 | 中 | キャッシュ機構の実装、スケールアウト対応 |
| S3ストレージコストの増大 | 中 | 中 | ライフサイクルポリシーの適切な設定 |
| Aurora DBの接続数上限 | 中 | 低 | コネクションプーリングの実装 |

### 10.2 運用リスク
| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| AWSコストの超過 | 高 | 中 | コスト監視アラート、リソース最適化 |
| セキュリティインシデント | 高 | 低 | WAF導入、定期的なセキュリティ監査 |

---

**文書バージョン**: 1.0  
**作成日**: 2025年1月  
**最終更新日**: 2025年1月